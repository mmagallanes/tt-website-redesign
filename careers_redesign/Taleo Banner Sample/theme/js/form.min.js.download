FJQ=jQuery.noConflict(true);FormJS={regex:{'URL':/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,'Email':/[a-z0-9!#$%&\'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&\'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i,'Number':/^[\-\+]?((([0-9]{1,3})([,][0-9]{3})*)|([0-9]+))?([\.]([0-9]+))?$/,'Integer':/^[\-\+]?\d+$/,'Ipv4':/^((([01]?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))[.]){3}(([0-1]?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))$/,'onlyNumberSp':/^[0-9\ ]+$/,'onlyLetterSp':/^[a-zA-Z\ \']+$/,'onlyLetterNumber':/^[0-9a-zA-Z]+$/,'zip':/^\d{5}$|^\d{5}-\d{4}$/,'phone':/^([\+][0-9]{1,3}([ \.\-])?)?([\(][0-9]{1,6}[\)])?([0-9 \.\-]{1,32})(([A-Za-z \:]{1,11})?[0-9]{1,4}?)$/},qsArgs:null,cookies:null,subscriberId:null,subsData:null,displayQSArgs:null,displayCookies:null,displaySubsData:null,freeEmailDomains:null,validationMessage:null,initComplete:false,inData:{},init:function(){if(FormJS.initComplete)return;FormJS.initComplete=true;FormJS.getInData();FormJS.getQSArgs();var cookies=FormJS.getCookies();if(cookies[FormJS.inData.visitorCookie])FormJS.getSubscribersData(FormJS.populateFormFromSubscribersData);else FormJS.populateFormFromQSArgs(FormJS.qsArgs);FJQ('span.email-edit-link').click(FormJS.editEmail);FJQ('span.email-save-link').click(FormJS.saveEmail);FJQ('input.list-radio').click(FormJS.subscribeToList);FJQ('input.list-all').click(FormJS.unsubscribeAll);FJQ('input.update-button').click(FormJS.checkForm);FJQ('div.ppt-form-link').click(FormJS.openPopup);if(FormJS.inData.subscriberId)FormJS.subscriberId=FormJS.inData.subscriberId;if(FormJS.inData.formType=='u'||(!FormJS.subscriberId&&!FJQ('input.email').val())){FJQ('span.email-label').html('Email Address:<br/>');FJQ('span.email-label').show();FJQ('span.email-edit-link').hide();FJQ('span.email-edit-span').show();FJQ('span.email-save-link').hide();FJQ('td.msg-notyours').hide();FJQ('input.email').val('');}FormJS.initCaptcha();if(FormJS.inData.fieldProps&&FormJS.inData.fieldProps.e&&FormJS.inData.fieldProps.e.blockFreeEmail)FormJS.fetchFreeEmailDomains();FormJS.fixMultiplePinpointeForms();FormJS.fixTooltips();FormJS.convertDateFields();},getInData:function(){var jsData=FJQ('input[name="jsdata"]');if(jsData.length==1){var jsdUREn=jsData.val();var jsdJSON=decodeURIComponent(jsdUREn);FormJS.inData=FJQ.parseJSON(jsdJSON);for(var key in FormJS.inData){if(key.substr(0,5)=='alert')FormJS.inData[key]=FormJS.inData[key].replace(/\+/g,' ');}}var subId=FJQ('input[name="subid"]');if(subId.length==1){var idJSON=subId.val();FormJS.inData.subscriberId=FJQ.parseJSON(idJSON);}var subIds=FJQ('input[name="subid"]');if(subIds.length==1){var idsJSON=subIds.val();FormJS.inData.subscriberIds=FJQ.parseJSON(idsJSON);}return true;},initCaptcha:function(baseURL,dynamic,session,length){if(!FormJS.inData.requireCaptcha)return false;if(FormJS.inData.captcha===undefined)return false;var baseURL=FormJS.inData.captcha.baseURL;var dynamic=FormJS.inData.captcha.dynamic;var session=FormJS.inData.captcha.session;var length=FormJS.inData.captcha.length;var urls=FormJS.captcha.getURLs(baseURL,dynamic,session,length);var captchaSpan=FJQ('span.form-captcha-span');for(var i=0,j=urls.length;i<j;i++)captchaSpan.append('<img src="'+urls[i]+'" alt="img'+i+'"/>');return true;},captcha:{sessionIDString:'',captchaURLs:[],getRandom:function(lowerBound,upperBound){return Math.floor((upperBound-lowerBound+1)*Math.random()+lowerBound);},getRandomLetter:function(){return String.fromCharCode(FormJS.captcha.getRandom(65,90));},getSID:function(){if(FormJS.captcha.sessionIDString.length<=0){var sidStr='';for(var i=0;i<32;i++)sidStr+=FormJS.captcha.getRandomLetter();FormJS.captcha.sessionIDString=sidStr;}return FormJS.captcha.sessionIDString;},getURLs:function(baseURL,dynamic,session,length){if(FormJS.captcha.captchaURLs.length<=0){var sid=FormJS.captcha.getSID();var tempURL=baseURL+'?c=';if(dynamic){tempURL+=FormJS.captcha.getRandom(1,1000);if(session)tempURL+='&ss='+sid;FormJS.captcha.captchaURLs.push(tempURL);}else{for(var i=0;i<length;i++){var tempEach=tempURL+i;if(session)tempEach+='&ss='+sid;FormJS.captcha.captchaURLs.push(tempEach);}}}return FormJS.captcha.captchaURLs;}},getURL:function(which){return FormJS.inData.urlBase+FormJS.inData[which];},getCookies:function(){var cookieList=document.cookie.split(';');var cookies={};for(var i=0;i<cookieList.length;i++){if(cookieList[i]==='')continue;var parts=cookieList[i].split('=',2);var key=FJQ.trim(parts[0]);var value=parts[1]?FJQ.trim(parts[1]):'';if(cookies[key]){if(Array.isArray(cookies[key]))cookies[key].push(value);elsecookies[key]=[cookies[key],value];}else{cookies[key]=value;}}if(FormJS.displayCookies)FormJS.displayCookies(cookies);return FormJS.cookies=cookies;},getQSArgs:function(){var qsArgs={};var urlParts=location.href.split('?',2);if(urlParts.length>1){var qsParts=urlParts[1].split('&');for(var i=0;i<qsParts.length;i++){var kv=qsParts[i].split('=',2);var key=FormJS.urlDecode(kv[0]);var value=kv.length>1?FormJS.urlDecode(kv[1]):1;if(key.substr(-2)=='[]'){if(qsArgs[key]==undefined)qsArgs[key]=[value];elseqsArgs[key].push(value);}else{qsArgs[key]=value;}}}if(FormJS.displayQSArgs)FormJS.displayQSArgs(qsArgs);return FormJS.qsArgs=qsArgs;},getSubscribersData:function(callback){FJQ.ajax({cache:false,url:FormJS.getURL('visDataURL'),type:'POST',dataType:'json',data:{},success:function(response,textStatus,jqXHR){if(!response){console.log("Invalid visdata response for token "+token);return false;}if(response.status!='ok'){console.log("Error visdata response for token "+token+"\n"+response.error);return false;}callback(response.data);},error:function(jqXHR,textStatus,errorThrown){console.log('Error: visdata FAILED -- '+errorThrown);}});},populateFormFromQSArgs:function(qsArgs){for(var name in qsArgs){var fields=FormJS.getFormFields(name);if(fields.length>0)FormJS.populateFormFields(fields,qsArgs[name]);}return true;},populateFormFromSubscribersData:function(data){var subsData=null;var subsId=0;if(FormJS.inData.subscriberId)subsId=FormJS.inData.subscriberId;else if(FormJS.qsArgs['M'])subsId=FormJS.qsArgs['M'];if(data[sid]){subsData=data[sid];}else{var emailIn=FJQ('input[name="email"]');var subsEmail=emailIn.length>0?emailIn.val():'';if(subsEmail){for(var sid in data){if(subsEmail&&data[sid].email==subsEmail){subsData=data[sid];break;}}}}if(!subsData){var subsListId=FormJS.qsArgs['L']?FormJS.qsArgs['L']:0;if(subsListId){for(var sid in data){if(subsListId&&data[sid].listid==subsListId){subsData=data[sid];break;}}}} if(subsData){if(subsData.email){var fields=FormJS.getFormFields('email');if(fields.length>0)FormJS.populateFormFields(fields,subsData.email);}if(subsData.format){var fields=FormJS.getFormFields('format');if(fields.length>0)FormJS.populateFormFields(fields,subsData.format);}for(var cfi in subsData.customfields){var cf=subsData.customfields[cfi];var fieldname='CustomFields['+cf.id+']';var fields=FormJS.getFormFields(fieldname);if(fields.length>0)FormJS.populateFormFields(fields,cf.value);}}if(FormJS.displaySubsData)FormJS.displaySubsData(subsData);FormJS.subsData=subsData; FormJS.populateFormFromQSArgs(FormJS.qsArgs);},getFormFields:function(name){var nen='[name="'+name+'"]';var selector='input'+nen+',select'+nen+',textarea'+nen;var fields=FJQ(selector);if(fields.length>0)return fields;nen='[fname="'+name+'"]';selector='input'+nen+',select'+nen+',textarea'+nen;fields=FJQ(selector);if(fields.length>0)return fields;nen='[fname="'+FormJS.urlDecode(name)+'"]';selector='input'+nen+',select'+nen+',textarea'+nen;fields=FJQ(selector);if(fields.length>0)return fields;return[];},populateFormFields:function(fields,value){for(var i=0;i<fields.length;i++){var field=fields[i];if(field.type=='checkbox'){FJQ(field).prop('checked',value.indexOf(field.value)==-1?false:true);}else if(field.type=='radio'){if(field.value==value)FJQ(field).prop('checked',true);}else if(field.type=='date'){}else{FJQ(field).val(value);}}return true;},showHelpText:function(event){var htGroup=FJQ(this).parents('span.helpTextGroup');var ht=htGroup.children('span.helpText');event.preventDefault();event.stopPropagation();ht.toggle();},checkForm:function(event){event.preventDefault();var f=event.target.form;if(FormJS.inData.formType&&FormJS.inData.formType=='f'){if(!FormJS.validateFormSF(f))return false;f.submit();return true;}if(!FormJS.validateForm(f))return false;FJQ('td.message').html('');var subRadios=FJQ('input[type="radio"].list-radio');if(subRadios.length>0){var subListRadios=FJQ('input[type="radio"][value="1"].list-radio:checked');var unsubListRadios=FJQ('input[type="radio"][value!="1"].list-radio:checked');for(var i=0;i<subListRadios.length;i++){var subListRadio=subListRadios[i];var listid=FJQ(subListRadio).attr('listid');var listsTxt=FJQ('#lists_txt_'+listid);listsTxt.attr('name','');listsTxt.attr('value','');}for(var i=0;i<unsubListRadios.length;i++){var unsubListRadio=unsubListRadios[i];var listid=FJQ(unsubListRadio).attr('listid');var name=FJQ(unsubListRadio).attr('name');var value=FJQ(unsubListRadio).attr('value');var listsTxt=FJQ('#lists_txt_'+listid);listsTxt.attr('name',name);listsTxt.attr('value',value);}}var subHiddens=FJQ('input[type="hidden"].list-hidden');if(subHiddens.length>0){for(var i=0;i<subHiddens.length;i++){var subHidden=subHiddens[i];var listid=FJQ(subHidden).attr('listid');var listsTxt=FJQ('#lists_txt_'+listid);listsTxt.attr('name','');listsTxt.attr('value','');}}FJQ(f).append('<input type="hidden" name="hidden_email" value="'+f.email.value+'"/>');f.submit();return true;},validateForm:function(f){if(FormJS.inData.formType&&FormJS.inData.formType=='u'){var emailIn=f.nsemail;}else{var emailIn=f.email;}var email=FJQ(emailIn).val();if(!email||!FJQ.trim(email)){alert(FormJS.inData.alertEnterEmail);emailIn.focus();return false;}if(!FormJS.regex.Email.test(email)){alert(FormJS.inData.alertInvalidEmail);emailIn.focus();return false;}var emailDomain=email.substr(email.indexOf('@')+1).toLowerCase();var emailProps=FormJS.inData.fieldProps?FormJS.inData.fieldProps.e:null;if(emailProps&&emailProps.domainsToBlock){var blockDomains=emailProps.domainsToBlock.toLowerCase().split(/,\s*/);if(blockDomains.indexOf(emailDomain)!=-1){alert(FormJS.inData.alertBadEmailDomain);emailIn.focus();return false;}}if(emailProps&&emailProps.blockFreeEmail&&FormJS.freeEmailDomains){if(FormJS.freeEmailDomains.indexOf(emailDomain)!=-1){alert(FormJS.inData.alertFreeEmailDomain);emailIn.focus();return false;}}var formatSel=f.format;if(FormJS.inData.requireFormat&&f.format.type!='hidden'){if(!FJQ(formatSel).val()){alert(FormJS.inData.alertChooseFormat);formatSel.focus();return false;}}var captchaIn=f.captcha;if(FormJS.inData.requireCaptcha){if(!FJQ(captchaIn).val()){alert(FormJS.inData.alertEnterCaptcha);captchaIn.focus();return false;}}if(FormJS.inData.requireLists){var subRadios=FJQ('input[type="radio"].list-radio');var subListRadios=FJQ('input[type="radio"][value="1"].list-radio:checked');var unsubListRadios=FJQ('input[type="radio"][value!="1"].list-radio:checked');if(subRadios.length>0){if(subRadios.length<1){alert(FormJS.inData.alertChooseLists);return false;}}}return FormJS.validateCustomFields();},validateCustomFields:function(){var fields=FJQ('input.ppCustField');var missings=[];var invalids=[];for(var i=0;i<fields.length;i++){var field=fields[i];var fid=FJQ(field).attr('fid');var reqd=FJQ(field).attr('reqd');reqd=reqd!==undefined&&reqd=="1";var ftype=FJQ(field).attr('ftype');var val=FJQ(field).val();var tval=FJQ.trim(val);if(val&&val!=tval)FJQ(field).val(val=tval);var props=FormJS.inData.fieldProps[fid];var fname=props.label;if(reqd&&(val===undefined||val===null||val==='')){missings.push(fname);continue;}if(ftype&&val){var regex=FormJS.regex[ftype];if(regex&&!regex.test(val))invalids.push(fname);}}var msgs=[];if(missings.length>0)msgs.push("Missing "+missings.join(', '));if(invalids.length>0)msgs.push("Invalid "+invalids.join(', '));if(msgs.length>0){FormJS.validationMessage=msgs.join("\n");alert(FormJS.validationMessage);return false;}return true;},validateFormSF:function(f){var myEmailIn=f.myemail;var myEmail=FJQ(myEmailIn).val();if(!myEmail||!FJQ.trim(myEmail)){alert(FormJS.inData.alertEnterEmail);myEmailIn.focus();return false;}if(!FormJS.regex.Email.test(myEmail)){alert(FormJS.inData.alertInvalidEmail);myEmailIn.focus();return false;}var friendsEmailIn=f.friendsemail;var friendsEmail=FJQ(friendsEmailIn).val();if(!friendsEmail||!FJQ.trim(friendsEmail)){alert(FormJS.inData.alertEnterFriendsEmail);friendsEmailIn.focus();return false;}var emails=friendsEmail.split(',');var invalidEmails=[];for(var i=0;i<emails.length;i++){emails[i]=FJQ.trim(emails[i]);if(!FormJS.regex.Email.test(emails[i]))invalidEmails.push(emails[i]);}if(invalidEmails.length>0){alert(FormJS.inData.alertInvalidFriendsEmail);friendsEmailIn.focus();return false;}var captchaIn=f.captcha;if(FormJS.inData.requireCaptcha){if(!FJQ(captchaIn).val()){alert(FormJS.inData.alertEnterCaptcha);captchaIn.focus();return false;}}return true;},openPopup:function(event){FJQ('div.ppt-form-link').hide();FJQ('div.ppt-form-overlay').show();FJQ('div.ppt-form-popup-container').show();},fetchFreeEmailDomains:function(){if(FormJS.freeEmailDomains&&FormJS.freeEmailDomains.length>0)return true;FJQ.ajax({cache:false,url:FormJS.getURL('svcURL'),type:'POST',dataType:'json',data:{r:'freeemaildomains'},success:function(response){FormJS.freeEmailDomains=response.data.domains;},error:function(response,textStatus,errorThrown){console.log("Error: fetchFreeEmailDomains FAILED -- "+errorThrown);}});},subscribeToList:function(event){FJQ('input.list-all').prop('checked',false);},unsubscribeAll:function(event){if(event.target.checked){var subRadios=FJQ('input[type="radio"][value="1"].list-radio');var unsubRadios=FJQ('input[type="radio"][value!="1"].list-radio');subRadios.prop('checked',false);unsubRadios.prop('checked',true);}},editEmail:function(sid){FJQ('span.email-label').hide();FJQ('span.email-edit-link').hide();FJQ('span.email-edit-span').show();},isValidEmailAddress:function(emailAddress){var pattern=new RegExp(/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/);return pattern.test(emailAddress);},saveEmail:function(sid){if(FormJS.isValidEmailAddress(FJQ('#email').val())){FJQ.ajax({cache:false,url:FormJS.getURL('remoteURL'),type:'POST',dataType:'html',data:{what:'changeemail',sid:FormJS.subscriberId,email:FJQ('#email').val()},success:function(response,textStatus,jqXHR){if(response=='Done'){FJQ('span.email-label').html(FJQ('#email').val());FJQ('span.email-edit-span').hide();FJQ('span.email-label').show();FJQ('span.email-edit-link').show();alert("Your email address updated successfully.");}else{alert("An error occurred while updating email address.");console.log("Error -- saveEmail FAILED.");}},error:function(jqXHR,textStatus,errorThrown){alert("An error occurred while updating email address.");console.log('Error: saveEmail FAILED -- '+errorThrown);}});}else{alert("Please enter a valid email address.");}},urlDecode:function(str){return decodeURIComponent(str).replace(/\+/g,' ');},openDialog:function(){window.location.replace("#openModal");if((typeof window.history.replaceState=='function')&&!FormJS.isMicrosoft()){var newHRef=window.location.href.slice(0,-10);window.history.replaceState({},'',newHRef);}},closeDialog:function(){window.location.replace("#close");if((typeof window.history.replaceState=='function')&&!FormJS.isMicrosoft())window.history.replaceState({},'',window.location.href.slice(0,-6));},getIEVersion:function(){var sAgent=window.navigator.userAgent;var idx=sAgent.indexOf("MSIE");if(idx>0)return parseInt(sAgent.substring(idx+5,sAgent.indexOf(".",idx)));if(!!navigator.userAgent.match(/Trident\/7\./))return 11;return 0;},getEdge:function(){var sAgent=window.navigator.userAgent;return sAgent.indexOf("Edge")!=-1;},isMicrosoft:function(){return FormJS.getIEVersion()>0||FormJS.getEdge();},fixMultiplePinpointeForms:function(){var starfallTimers=document.getElementsByName("timerStarfall");if(starfallTimers.length>1){for(var i=1;i<starfallTimers.length;i++){setInterval(function(timer){FJQ(timer).val(FJQ('#timerStarfall').val());},1001,starfallTimers[i]);}}},fixTooltips:function(){ var helpTextGroups=FJQ('.ppt-form span.helpTextGroup');for(var i=helpTextGroups.length-1;i>=0;i--){var helpTextG=FJQ(helpTextGroups[i]);var text=helpTextG.find('span.helpText')[0].innerHTML;helpTextG.find('.helpText').remove();helpTextG.attr('data-balloon',text);helpTextG.attr('data-balloon-pos','right');}},convertDateFields:function(){ var test=document.createElement('input');test.type='date'; if(test.type==='date'){let dateSelectGroups=FJQ('select[id$=yy]').parent(); for(var i=dateSelectGroups.length-1;i>=0;i--){let dateSelectGroup=FJQ(dateSelectGroups[i]); let dateCurYY=dateSelectGroup.find('select[id$=yy]').val();let dateCurMM=dateSelectGroup.find('select[id$=mm]').val();let dateCurDD=dateSelectGroup.find('select[id$=dd]').val(); let dateMinYY=dateSelectGroup.find('select[id$=yy] option:first').val();let dateMaxYY=dateSelectGroup.find('select[id$=yy] option:last').val();let dateMinMM=dateSelectGroup.find('select[id$=mm] option:first').val();let dateMaxMM=dateSelectGroup.find('select[id$=mm] option:last').val();let dateMinDD=dateSelectGroup.find('select[id$=dd] option:first').val();let dateMaxDD=dateSelectGroup.find('select[id$=dd] option:last').val(); let dateMin=dateMinYY+'-'+dateMinMM+'-'+dateMinDD;let dateMax=dateMaxYY+'-'+dateMaxMM+'-'+dateMaxDD;let dateValue=dateCurYY+'-'+dateCurMM+'-'+dateCurDD; let dateID=dateSelectGroup.find('select[id$=yy]').attr('id').replace('_yy','');let dateName=dateSelectGroup.find('select[id$=yy]').attr('name').replace('[yy]',''); dateSelectGroup.find('select[id$=yy]').remove();dateSelectGroup.find('select[id$=mm]').remove();dateSelectGroup.find('select[id$=dd]').remove();dateSelectGroup.prepend('<input type="date" id="'+dateID+'" name="'+dateName+'" min="'+dateMin+'" max="'+dateMax+'" value="'+dateValue+'">');}}}};FJQ(FormJS.init);